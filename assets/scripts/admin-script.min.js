jQuery(document).ready(function(d){var l="#spin_game_preview .gh_spinner",j=d(l);var i="#spin_game_options .option_wrapper",c=d(i);var p="#spin_items_wrapper",m=d(p);var q=m.find(".item_row").length?m.find(".item_row").get(0).outerHTML:"";var f=j.find(".triangle").length?j.find(".triangle").get(0).outerHTML:"";var a={rotate:i+' [name="rotate"]',imgX:i+' [name="img_x"]',imgY:i+' [name="img_y"]',imgSize:i+' [name="img_size"]',spinsCount:i+' [name="spin_items_count"]',spinSize:i+' [name="size"]',textPosition:i+' [name="text_position"]',template:i+' [name="template"]',duration:i+' [name="duration"]',fontSize:i+' [name="font_size"]',borderSize:i+' [name="border_size"]',borderColor:i+' [name="border_color"]'};d(".select2_wrapper_gh select").select2();d(":not(.select2_wrapper_gh) .select2_gh").select2();k();function k(){var v=d(a.template).val();var x="visible";var w=false,u=false;if(v==4){d.each(m.find(".item_row"),function(){var B=parseInt(d(this).attr("data-id"));var z=d('[data-id="'+B+'"] .gh_show select').val();var A=d('.item_row[data-id="'+B+'"] .gh_image .cropped_image').val();var y="none";if(A&&("image"==z||"image_text"==z)){var y="url("+A+")"}j.find('.triangle[data-id="'+B+'"]').css({"border-image-source":y})});x="hidden";w=true}else{d.each(m.find(".item_row"),function(){var A=parseInt(d(this).attr("data-id"));var y=d('[data-id="'+A+'"] .gh_show select').val();j.find('.triangle[data-id="'+A+'"]').css({"border-image-source":"none"});var z=d('.item_row[data-id="'+A+'"] .gh_image .real_image').val();if(z&&("image"==y||"image_text"==y)){j.find('.triangle[data-id="'+A+'"]').find(".image").html('<img src="'+z+'" />')}})}if(v==2){u=true;d(a.borderColor).closest(".wp-picker-container").addClass("readonly");setTimeout(function(){d(a.borderColor).closest(".wp-picker-container").addClass("readonly")},500)}else{d(a.borderColor).closest(".wp-picker-container").removeClass("readonly")}d(a.borderSize).attr("readonly",u);d(a.imgSize).attr("readonly",w);d(a.imgX).attr("readonly",w);d(a.imgY).attr("readonly",w);d.each(j.find(".triangle"),function(){d(this).find(".image").css({visibility:x})});d.each(d(".gh_image"),function(){if(v==4&&d(this).find(".image_wrapper img").length){d(this).find(".edit_image").show()}else{d(this).find(".edit_image").hide()}})}var e=parseInt(d(a.spinsCount).val());var s=e;function r(){var w=parseInt(d(a.spinsCount).val());s=m.find(".item_row").length;if(s<w){for(var v=s+1;v<=w;v++){var u=q.replace(/id="1"/g,'id="'+v+'"').replace(/items\[1\]/g,"items["+v+"]").replace(/Item\s+1/g,"Item "+v);u=u.replace(/src=["|'][^"|']+"/,"");m.append(u);var x=f.replace(/id="1"/g,'id="'+v+'"');x=x.replace(/<img[^>]+>/,"");d('[name="items['+v+'][image]"]').val(0);j.append(x);d('[name="items['+v+'][color]"]').val(n()).change();d('.item_row[data-id="'+v+'"] .remove_image').click()}}else{d.each(m.find(".item_row"),function(){var y=parseInt(d(this).attr("data-id"));if(y>w){d(this).remove()}});d.each(j.find(".triangle"),function(){var y=parseInt(d(this).attr("data-id"));if(y>w){d(this).remove()}})}d(".roulette .gh_spinner").attr("class","gh_spinner");g();h();d("#gh_tab_mode").change()}c.find(".border_color").wpColorPicker({change:function(u,v){r()}});g();function g(){d(".gh_color .gh_color_picker").wpColorPicker({clear:false,change:function(w,x){var u=d(this).val();var v=parseInt(d(this).parents(".item_row").attr("data-id"));if(v){j.find('.triangle[data-id="'+v+'"]').css({color:u,"border-top-color":u})}else{if(d(this).hasClass("border_color")){r()}}}})}function h(){var u=[];d.each(m.find(".item_row .gh_color input.gh_color_picker"),function(y,x){u.push(d(x).val())});var w={colors:u.join(";"),size:d(a.spinSize).val(),img_size:d(a.imgSize).val(),img_y:d(a.imgY).val(),img_x:d(a.imgX).val(),text_position:d(a.textPosition).val(),duration:d(a.duration).val(),template:d(a.template).val(),font_size:d(a.fontSize).val(),border:d('[name="border_size"]').val()+";"+d('[name="border_color"]').val(),rotate:d(a.rotate).val()};k();var v=SpinData.pluginUrl+"includes/style.php?"+b(w);d("#spin_style_gh-css").attr("href",v);j.find(".triangle .image img").css({left:"",top:""})}function b(w,u,x){var v=[];Object.keys(w).forEach(function(B){var y=B;u&&!isNaN(y)?y=u+y:"";var y=encodeURIComponent(y.replace(/[!'()*]/g,escape));x?y=x+"["+y+"]":"";if(typeof w[B]==="object"){var A=b(w[B],null,y);v.push(A)}else{var z=encodeURIComponent(w[B].replace(/[!'()*]/g,escape));v.push(y+"="+z)}});return v.join("&")}function n(){var w="0123456789ABCDEF";var u="#";for(var v=0;v<6;v++){u+=w[Math.floor(Math.random()*16)]}return u}(function(){var y=0;var x=0;var w=0;var v=0;var u=false;d(document).on("dragstart",l+" .image img",function(z){z.preventDefault()});d(document).on("mousedown",l+' .triangle[data-id="1"] .image img',function(z){y=z.clientX;x=z.clientY;v=parseFloat(j.find(".image img").css("top"));w=parseFloat(j.find(".image img").css("left"));u=true;d(".spin_image_move_gh").fadeOut("slow")});d(document).on("mouseup",function(z){u=false});d(document).on("mousemove",function(C){if(!u){return}var A=(y-C.clientX)/4;var F=(x-C.clientY)/4;var D=d(a.rotate).val();if(D==-90){A*=-1;F*=-1}else{if(D==0){F*=-1}}var z=A+w;var E=F+v;if(D==0){var B=z;z=E;E=B}j.find(" .image img").css({top:E,left:z});d(a.imgX).val(z.toFixed());d(a.imgY).val(E.toFixed());o()})})();d(document).on("change",a.rotate,function(){var u,w;var v=d(this).val();if(v==0){u=-5;w=-40}else{if(v>0){u=-120;w=-8}else{u=110;w=-8}}d(a.imgX).val(u);d(a.imgY).val(w).change()});d(document).on("change",'input[type="number"]',function(){if(d(this).get(0).hasAttributes("min")){var v=parseInt(d(this).attr("min"))||false;if(v!==false&&d(this).val()<v){d(this).val(v)}}if(d(this).get(0).hasAttribute("max")){var u=parseInt(d(this).attr("max"))||false;if(u!==false&&d(this).val()>u){d(this).val(u)}}});d(document).on("change",i+" input, "+i+" select",function(){r()});d(document).on("keyup",p+" .gh_text input",function(){var w=d(this).parents(".item_row").attr("data-id");var v=d(this).val().replace(/\s/g,"&nbsp;");var u=d(this).parents(".item_row").find(".gh_show select").val();if(u=="text"||u=="image_text"){j.find('.triangle[data-id="'+w+'"] .content  .text').html(v)}});d(document).on("click",p+" .add_image",function(x){x.preventDefault();var v=d(this).parents(".gh_image");var y=d(this).parents(".item_row");var w=d(this);var u=wp.media({library:{type:"image"},button:{text:"Select"},multiple:false});u.on("select",function(){var z=u.state().get("selection").first().toJSON();v.find("input.image_id").val(z.id);v.find(".image_wrapper").html('<img class="custom_media_image" src=""  />');v.find(".custom_media_image").attr("src",z.url).css("display","block").change();y.find(".gh_show select").change();j.find(".image img").mousedown().mousemove().mouseup();if(d(a.template).val()==4){v.find(".edit_image").show()}}).open();return false});d(document).on("click",p+" .remove_image",function(v){v.preventDefault();var u=d(this).parents(".gh_image");var w=d(this).parents(".item_row");u.find('input[type="hidden"]').val("");u.find(".image_wrapper").html("");w.find(".gh_show select").change();u.find(".edit_image").hide()});d(document).on("change","#spin_items_wrapper .gh_show select",function(){var y=d(this).parents(".item_row").attr("data-id");var w=d(this).val();var x=d(this).parents(".item_row");var v=x.find(".image_id");var u=d(a.template).val();if(u==4&&x.find(".image_id").val()!=0){d.ajax({url:SpinData.ajaxUrl,method:"post",data:{action:"get_spin_cropped_image",id:x.find(".image_id").val()}}).done(function(z){t(w,x,y,v,z)})}else{t(w,x,y,v,"")}});function t(x,u,w,v,A){var D=d('.gh_spinner [data-id="'+w+'"]');var C=d(".gh_text input").val().trim()||"&nbsp;";var z=u.find(".image_wrapper img").length?u.find(".image_wrapper img").get(0).outerHTML:'<img src="'+SpinData.noImage+'" />';var B=d(a.template).val();var y=A?"url("+A+")":"none";switch(x){case"text":D.find(".text").html(C);B==4?D.css({"border-image-source":"none"}):D.find(".image").html("");break;case"image":D.find(".text").html("&nbsp;");B==4?D.css({"border-image-source":y}):D.find(".image").html(z);break;case"image_text":D.find(".text").html(C);B==4?D.css({"border-image-source":y}):D.find(".image").html(z);break}D.find(".image img").attr("srcset","").attr("sizes","")}d(document).on("change",p+" .gh_product_wrapper select, "+p+" .gh_coupon_wrapper select",function(){var w=d(this).parents(".item_row");var v=w.attr("data-id");var u=d(this).val()||0;d('[name="items['+v+'][obj_id]"]').val(u)});d(document).on("change",p+" .gh_type select",function(){var x=d(this).parents(".item_row").attr("data-id");var u=d('.gh_spinner [data-id="'+x+'"]');var v=d(this).val();var w=d(this).parents(".item_row");w.find(".gh_product_wrapper").hide();w.find(".gh_coupon_wrapper").hide();w.find('.gh_show select [value="pr-image"]').prop("disabled",true);w.find('.gh_show select [value="pr-image_text"]').prop("disabled",true);if(v=="product"){w.find('.gh_show select [value="pr-image"]').prop("disabled",false);w.find('.gh_show select [value="pr-image_text"]').prop("disabled",false);w.find(".gh_product_wrapper").show()}else{if(v=="coupon"){w.find(".gh_coupon_wrapper").show()}}});m.find(".gh_type select").change();d(document).on("change","#gh_tab_mode",function(){var w=d("#spin_items_wrapper .nav_bar_wrapper");if(d(this).is(":checked")){var u="nav-tab-active";var v='<nav class="nav-tab-wrapper">';d.each(d("#spin_items_wrapper .item_row"),function(){var x=d(this).attr("data-id");v+='<a href="#" class="nav-tab '+u+'" data-id="'+x+'" >'+d(this).find("h4").text()+"</a>";u=""});v+="</nav>";w.html(v);w.slideDown();d("#spin_items_wrapper .item_row").not(":first").slideUp()}else{w.slideUp();d("#spin_items_wrapper .item_row").slideDown()}});d("#gh_tab_mode").click();d(document).on("click","#spin_items_wrapper .nav_bar_wrapper a",function(u){u.preventDefault();d("#spin_items_wrapper .nav_bar_wrapper a").removeClass("nav-tab-active");d(this).addClass("nav-tab-active");var v=d(this).attr("data-id");d("#spin_items_wrapper .item_row").slideUp();d('#spin_items_wrapper .item_row[data-id="'+v+'"]').slideDown()});d(document).on("click",".roulette .spin-start",function(){var v=d(".gh_spinner .triangle").length;var u=d(".roulette .gh_spinner");var w=parseInt(Math.random()*(v-1)+1);var x="index-";u.toggleClass("spin");u.get(0).className=u.get(0).className.replace(new RegExp("(^|\\s)"+x+"\\S+","g"),"");u.addClass(x+w);setTimeout(function(){u.css({transition:"none"});u.get(0).className=u.get(0).className.replace(new RegExp("(^|\\s)"+x+"\\S+","g"),"");setTimeout(function(){u.css({transition:""})},1)},1500+parseInt(d(a.duration).val()))});d(document).on("click","#spin_game_form  .add_image",function(v){v.preventDefault();var w=d('[name="form[bg_image]"]');var u=wp.media({library:{type:"image"},button:{text:"Select"},multiple:false});u.on("select",function(){var x=u.state().get("selection").first().toJSON();w.val(x.url)}).open();return false});d(document).on("click","#spin_game_form .remove_image",function(u){u.preventDefault();var v=d('[name="form[bg_image]"]');v.val("")});d(document).on("click","#spin_messages_wrapper .add_image",function(u){u.preventDefault();var w=d('[name="result[bg_image]"]');var v=wp.media({library:{type:"image"},button:{text:"Select"},multiple:false});v.on("select",function(){var x=v.state().get("selection").first().toJSON();w.val(x.url)}).open();return false});d(document).on("click","#spin_messages_wrapper .remove_image",function(u){u.preventDefault();var v=d('[name="result[bg_image]"]');v.val("")});d(document).on("click","#gh_audio_section .add_audio",function(v){v.preventDefault();var w=d(this).parents(".item");var y=w.find("input");var u=w.find("audio");var x=wp.media({library:{type:"audio"},button:{text:"Select"},multiple:false});x.on("select",function(){var B=x.state().get("selection").first().toJSON();y.val(B.id);var A=B.url+"?_="+Math.random();var z=B.url.split("/").reverse()[0];u.attr("src",A);u.find("source").attr("src",A);u.find("a").attr("href",A).html(B.url);w.find(".name").html("( "+z+" )")}).open();return false});d(document).on("click","#gh_audio_section .remove_audio",function(u){u.preventDefault();var v=d(this).parents(".item");var w=v.find("input");w.val("0");v.find(".name").html("( )")});d(document).on("click","#gh_audio_section .default_audio",function(w){w.preventDefault();var x=d(this).parents(".item");var u=x.find("audio");var z=x.find("input");var y=x.attr("data-default")+"?_="+Math.random();var v=x.attr("data-default").split("/").reverse()[0];u.attr("src",y);u.find("source").attr("src",y);u.find("a").attr("href",y).html(x.attr("data-default"));z.val("");x.find(".name").html("( "+v+" )")});o(true);function o(u){var v=j.find('.triangle[data-id="1"] .image img');if(v.length){d(".spin_image_move_gh").css({top:parseInt(v.offset().top)+(parseInt(v.width())/2),left:parseInt(v.offset().left)+(parseInt(v.width()))})}else{d(".spin_image_move_gh").fadeOut();return}var x=parseInt(j.get(0).getBoundingClientRect().left)+parseInt(j.width());var w=parseInt(d(".spin_image_move_gh").css("left"));if(u){d(".spin_image_move_gh").fadeIn()}if(x>w){d(".spin_image_move_gh").css({"pointer-events":"none"});setTimeout(function(){d(".spin_image_move_gh").fadeOut("slow")},8000)}else{d(".spin_image_move_gh").css({"pointer-events":""});d(".spin_image_move_gh").fadeIn()}}d(document).on("mousedown",".spin_image_move_gh",function(v){var w=parseInt(j.get(0).getBoundingClientRect().left)+parseInt(j.width());var u=parseInt(d(".spin_image_move_gh").css("left"));if(w<u){d(a.rotate).change();d(".spin_image_move_gh").fadeOut("slow")}});d(document).on("change",".bulk_action .bulk_prize_type select",function(u){if(!d(this).val()){return}m.find(".gh_type select").val(d(this).val()).change();d(this).val("")});d(document).on("change",".bulk_action .bulk_show select",function(u){if(!d(this).val()){return}m.find(".gh_show select").val(d(this).val()).change();d(this).val("")});if(typeof d.fn.sortable=="function"){d(".meta-box-sortables").sortable({disabled:true})}});